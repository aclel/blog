
# SILO Database

## General comments

- Remove _table suffix from all table names
- All tables should have a primary key called id
- Foreign keys should be name in the format: key_in_another_table_id. e.g. 'source_id' instead of just 'source'
- Use PostGIS?
- May be worth deleting all the migrations and existing databases, and starting from scratch on fresh databases
- What changes have been made to schema made since migrations were written, or never added to original script?
- Need to know more about observed, patched and gridded tables

## station_list_table

- Rename to stations
- Add id (serial) column to use as a primary key instead of station_number
- Rename station_name to name
- Rename station_number to number

Perhaps a separate table called station_modifications with the following fields:

- id (primary key)
- station_id (foreign key ref)
- modified_field ('latitude', 'longitude' or 'elevation')
- modified_value / original_value (depending on which is stored in the stations table)
- reason (text)

### Questions

- What is latitude/longitude_modified_by_qld_govt for?
- Current design only accounts for one modification being stored. Could there be multiple modifications? Is it so that you can keep track of database level changes?
- Use PostGIS geometry instead of lat/long columns?
- Lat/long size (17,17) is too big - 10,7 is enough for 1cm accuracy
- Do we need to store a lat/long datum?


## Variables

Many of the table names have "variables" at the end. eg. rainfall, maximum temperature, minimum temperature. There are no differences in structure between a lot of the tables, so we could merge them into a few tables that reference a new **variables** table to find their type. 

The variables table would have the following fields: 

- id
- description

The table would contain the following records:

- class_a_pan_evaporation
- maximum_temperature
- minimum_temperature
- radiometer
- rain
- sunshine_hours
- 9am_mean_sea_level_pressure
- 9am_vapour_pressure
- daily_class_a_pan_evaporation
- daily_maximum_temperature
- daily_minimum_temperature
- daily_radiation_table
- daily_rainfall_table
- fao56_evapotranspiration
- morton_actual_evapotranspiration
- morton_lake_evapotranspiration
- morton_potential_evapotranspiration
- morton_wet_evapotranspiration
- relative_humidity_at_tmax
- relative_humidity_at_tmin
- vapour_pressure_deficit
- 9am_mean_sea_level_pressure
- 9am_vapour_pressure
- daily_class_a_pan_evaporation
- daily_maximum_temperature
- daily_minimum_temperature
- daily_radiation
- daily_rainfall
- monthly_rainfall


## Observed hourly tables

All of these tables share the same fields. We could unify them all into one table called observed_hourly and reference the indicators table.

- Rename date_obtained_from_source to date_obtained?
- Rename source to source_id
- Rename observation_value to value

The observed_hourly table should have the following fields: 

- id
- station_id
- observation_date
- date_obtained
- value
- qa_flag_9am
- qa_flag_3pm
- source_id

### Questions

- Are the observation times ALWAYS going to be 9am and 3pm?
- We should probably move qa_flag_9am and qa_flag_3pm out of this table


## Observed daily tables

These tables should be merged into two tables called observed_daily and observed_daily_temperature_accumulation. The observed_daily table can reference the **variables** table.

- Add primary key id
- Rename 

observed_daily should have the following fields: 

- id
- variable_id
- station_id
- observation_date
- value
- qa_flag_id
- date_obtained_from_source
- source_id

observed_daily_temperature_accumulation should have the following fields: 

- observed_daily_id
- accumulation_day_count


## Observed monthly table

### Questions

What are the following fields in observed_monthly_rain_table and how are they derived?

- sum_of_daily_observed_values
- number_of_days_accounted_for


## Patched tables

All of the patched tables could be merged into one table called patched, which references the **variables** table.

patched should have the following fields

- id
- variable_id
- station_id
- observation_date
- value
- date_type_id

### Questions

- Meaning of observation date?


## Gridded tables

All of the gridded tables could be merged into one table called 'gridded', which references the **variables** table.

gridded should contain the following fields:

- id
- observation_date
- interpolated_surface - link to S3?
- date_surface_created
- variable_id

Questions
- Rasters stored on S3?
- What data should these tables actually contain?

## customer_table

The customer_table will be changed to 'users', because that is what is auto-generated by Laravel.

## reason_why_modified table

- Rename to modification_reason

## source_table

- Should be renamed to 'sources'
- The source column should be renamed to 'id'

## data_type_table

- Rename to data_types
- Use id (smallserial) as primary key column. Remove data_type column
- Rename description to name?

## qa_flag_table

- Rename to qa_flags
- Use id (smallserial) as primary key column. Remove flag column

## tasks

- Should be removed

## client_table

- Can this be removed?

## migrations

This table is automatically generated by Laravel when using migrations. We are not using Laravel's built in migrations so we can remove it.




----------
